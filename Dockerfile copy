FROM golang:1.16.3-buster

ENV GO111MODULE=on
ENV GOPATH=/go/mods

RUN groupadd --gid 1001 app && useradd -m -l --uid 1001 --gid 1001 app
RUN mkdir -p /go/src
COPY src /go/src
RUN chown -R app:app /go/src
RUN mkdir -p /go/mods && chown -R app:app /go/mods

USER app
WORKDIR /go/src

RUN go mod tidy

EXPOSE 8080
CMD ["go", "run", "krowsnest.go", "kubernetes.go", "kubernetesloader.go", "mermaid.go" ]
